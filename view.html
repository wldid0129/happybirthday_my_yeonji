<!DOCTYPE html>
<html lang="ko">
<head>
Â  <meta charset="UTF-8" />
Â  <meta name="viewport" content="width=device-width, initial-scale=1" />
Â  <title>ì—°ì§€ì˜ í¸ì§€í•¨ (ë³´ê¸° ì „ìš©)</title>

Â  <style>
Â  Â  /* ì‘ì„±ì ì½”ë“œì˜ ì „ì²´ CSSë¥¼ ê·¸ëŒ€ë¡œ ë³µì‚¬í–ˆìŠµë‹ˆë‹¤. */
Â  Â  body{
Â  Â  Â  margin:0;
Â  Â  Â  background: radial-gradient(circle at 20% 10%, rgba(255,255,255,.16), transparent 42%),
Â  Â  Â  Â  Â  Â  Â  Â  Â  linear-gradient(135deg, #b81d24 0%, #0b6b3a 100%);
Â  Â  Â  color:#fff;
Â  Â  Â  font-family: 'Apple SD Gothic Neo','Noto Sans KR',system-ui,sans-serif;
Â  Â  Â  overflow-x:hidden;
Â  Â  }

Â  Â  #snow{
Â  Â  Â  position:fixed;
Â  Â  Â  inset:0;
Â  Â  Â  pointer-events:none;
Â  Â  Â  z-index: 2;
Â  Â  }

Â  Â  .wrap{
Â  Â  Â  max-width: 980px;
Â  Â  Â  margin: 0 auto;
Â  Â  Â  padding: 28px 16px 80px;
Â  Â  Â  text-align:center;
Â  Â  Â  position: relative;
Â  Â  Â  z-index: 3;
Â  Â  }

Â  Â  h1{ margin:10px 0 6px; }
Â  Â  .sub{ font-size:14px; opacity:.85; margin-bottom:12px; }

Â  Â  .musicBtn{
Â  Â  Â  margin: 10px auto 16px;
Â  Â  Â  padding:10px 14px;
Â  Â  Â  border:0;
Â  Â  Â  border-radius:999px;
Â  Â  Â  background: rgba(255,255,255,.18);
Â  Â  Â  color:#fff;
Â  Â  Â  font-weight:700;
Â  Â  Â  cursor:pointer;
Â  Â  Â  backdrop-filter: blur(6px);
Â  Â  }

Â  Â  .stage{
Â  Â  Â  position:relative;
Â  Â  Â  width:min(520px, 92vw);
Â  Â  Â  aspect-ratio:1/1;
Â  Â  Â  margin:0 auto;
Â  Â  Â  background: rgba(255,255,255,.10);
Â  Â  Â  border: 1px solid rgba(255,255,255,.18);
Â  Â  Â  border-radius:22px;
Â  Â  Â  box-shadow:0 18px 50px rgba(0,0,0,.25);
Â  Â  Â  overflow:hidden;
Â  Â  }

Â  Â  .tree{
Â  Â  Â  position:absolute;
Â  Â  Â  inset:0;
Â  Â  Â  width:100%;
Â  Â  Â  height:100%;
Â  Â  Â  object-fit: contain;
Â  Â  Â  z-index: 1;
Â  Â  Â  filter: drop-shadow(0 16px 30px rgba(0,0,0,.22));
Â  Â  }

Â  Â  .treeGlow{
Â  Â  Â  position:absolute;
Â  Â  Â  inset:0;
Â  Â  Â  z-index: 2;
Â  Â  Â  pointer-events:none;
Â  Â  Â  background: radial-gradient(circle at 50% 40%, rgba(255,255,255,.20), transparent 55%);
Â  Â  Â  animation: glowPulse 2.4s ease-in-out infinite;
Â  Â  Â  mix-blend-mode: screen;
Â  Â  }
Â  Â  @keyframes glowPulse{
Â  Â  Â  0%{ opacity:.25; transform: scale(1); }
Â  Â  Â  50%{ opacity:.65; transform: scale(1.02); }
Â  Â  Â  100%{ opacity:.25; transform: scale(1); }
Â  Â  }

Â  Â  .light{
Â  Â  Â  position:absolute;
Â  Â  Â  width:10px;
Â  Â  Â  height:10px;
Â  Â  Â  border-radius:50%;
Â  Â  Â  background: rgba(255,255,255,.95);
Â  Â  Â  box-shadow: 0 0 14px rgba(255,255,255,.95);
Â  Â  Â  animation: twinkle 1.4s infinite ease-in-out;
Â  Â  Â  opacity: .75;
Â  Â  Â  z-index: 2;
Â  Â  }
Â  Â  @keyframes twinkle{
Â  Â  Â  0%{ transform: scale(.7); opacity:.35; }
Â  Â  Â  50%{ transform: scale(1.3); opacity:1; }
Â  Â  Â  100%{ transform: scale(.7); opacity:.35; }
Â  Â  }

Â  Â  Â .ornament{
Â  Â  Â  Â  position:absolute;
Â  Â  Â  Â  width:78px;
Â  Â  Â  Â  height:auto;
Â  Â  Â  Â  cursor:default; 
Â  Â  Â  Â  z-index: 3;
Â  Â  Â  Â  transform: translate(-50%, -50%);
Â  Â  Â  Â  filter: drop-shadow(0 10px 18px rgba(0,0,0,.35));
Â  Â  Â  Â  transition: none; /* í˜¸ë²„ íš¨ê³¼ ì œê±° */
        pointer-events: none; /* í´ë¦­ ì´ë²¤íŠ¸ ì›ì²œ ë´‰ì‡„ */
Â  Â  Â  }
Â  Â  Â .ornament:hover{
Â  Â  Â  Â  transform: translate(-50%, -50%); 
Â  Â  Â  }

Â  Â  Â /* ì´ë¯¸ì§€ê°€ ì¥ì‹ ê·¸ ìì²´ */
Â  Â  Â .ornament img{
Â  Â  Â  Â  width:100%;
Â  Â  Â  Â  height:auto;
Â  Â  Â  Â  display:block;
Â  Â  Â  }
Â  Â  .hook{
Â  Â  Â  position:absolute;
Â  Â  Â  width:18px;
Â  Â  Â  height:18px;
Â  Â  Â  border-radius:50%;
Â  Â  Â  border: 2px solid rgba(255,255,255,.95);
Â  Â  Â  background: rgba(0,0,0,.10);
Â  Â  Â  top:-14px;
Â  Â  Â  left:50%;
Â  Â  Â  transform: translateX(-50%);
Â  Â  Â  box-shadow: 0 6px 14px rgba(0,0,0,.25);
Â  Â  }
Â  Â  .string{
Â  Â  Â  position:absolute;
Â  Â  Â  width:2px;
Â  Â  Â  height:22px;
Â  Â  Â  background: rgba(255,255,255,.75);
Â  Â  Â  top:-22px;
Â  Â  Â  left:50%;
Â  Â  Â  transform: translateX(-50%);
Â  Â  Â  border-radius: 2px;
Â  Â  }
Â  Â  .note{
Â  Â  Â  position:absolute;
Â  Â  Â  right:-6px; 
Â  Â  Â  bottom:-6px; 
Â  Â  Â  width:30px;
Â  Â  Â  height:30px;
Â  Â  Â  border-radius:50%;
Â  Â  Â  background:#fff;
Â  Â  Â  color:#111;
Â  Â  Â  display:flex;
Â  Â  Â  align-items:center;
Â  Â  Â  justify-content:center;
Â  Â  Â  font-size:16px;
Â  Â  Â  box-shadow:0 6px 14px rgba(0,0,0,.25);
Â  Â  }

Â  Â  /* mailbox.png */
Â  Â  .mailbox{
Â  Â  Â  position:absolute;
Â  Â  Â  left:85%;
Â  Â  Â  top:86%;
Â  Â  Â  transform:translate(-50%,-50%);
Â  Â  Â  width:72px;
Â  Â  Â  height:72px;
Â  Â  Â  border-radius:18px;
Â  Â  Â  background: rgba(255,255,255,.12);
Â  Â  Â  display:flex;
Â  Â  Â  align-items:center;
Â  Â  Â  justify-content:center;
Â  Â  Â  cursor:pointer;
Â  Â  Â  z-index: 6;
Â  Â  Â  box-shadow: 0 14px 28px rgba(0,0,0,.25);
Â  Â  Â  backdrop-filter: blur(6px);
Â  Â  Â  border: 1px solid rgba(255,255,255,.2);
Â  Â  }
Â  Â  .mailbox:hover{ transform:translate(-50%,-50%) scale(1.03); }
Â  Â  .mailbox img{
Â  Â  Â  width:52px;
Â  Â  Â  height:52px;
Â  Â  Â  object-fit: contain;
Â  Â  Â  display:block;
Â  Â  Â  pointer-events:none;
Â  Â  Â  filter: drop-shadow(0 10px 18px rgba(0,0,0,.25));
Â  Â  }

Â  Â  /* ëª¨ë‹¬ */
Â  Â  .modalBack{
Â  Â  Â  position:fixed;
Â  Â  Â  inset:0;
Â  Â  Â  background:rgba(0,0,0,.55);
Â  Â  Â  display:none;
Â  Â  Â  align-items:center;
Â  Â  Â  justify-content:center;
Â  Â  Â  padding:16px;
Â  Â  Â  z-index: 20;
Â  Â  }
Â  Â  .modal{
Â  Â  Â  width:min(720px, 96vw);
Â  Â  Â  background: rgba(255,255,255,.96);
Â  Â  Â  color:#222;
Â  Â  Â  border-radius:18px;
Â  Â  Â  padding:16px;
Â  Â  Â  text-align:left;
Â  Â  Â  box-shadow: 0 18px 70px rgba(0,0,0,.35);
Â  Â  }
Â  Â  .top{
Â  Â  Â  display:flex;
Â  Â  Â  justify-content:space-between;
Â  Â  Â  align-items:center;
Â  Â  Â  margin-bottom:10px;
Â  Â  }
Â  Â  .close{
Â  Â  Â  border:0;
Â  Â  Â  background:#eee;
Â  Â  Â  padding:6px 10px;
Â  Â  Â  border-radius:8px;
Â  Â  Â  cursor:pointer;
Â  Â  }

Â  Â  .letters{
Â  Â  Â  max-height:360px;
Â  Â  Â  overflow:auto;
Â  Â  Â  background:#f7f7f7;
Â  Â  Â  border-radius:12px;
Â  Â  Â  padding:10px;
Â  Â  Â  color:#222;
Â  Â  }
Â  Â  .item{
Â  Â  Â  background:#fff;
Â  Â  Â  border-radius:12px;
Â  Â  Â  padding:10px;
Â  Â  Â  margin-bottom:8px;
Â  Â  Â  font-size:14px;
Â  Â  }
Â  Â  .meta{ font-size:12px; opacity:.6; margin-bottom:4px; }
Â  Â  .msg{ white-space: pre-line; line-height: 1.7; }

Â  Â  /* ë¡œê·¸ì¸ íŒ¨ë„ */
Â  Â  .loginPanel{
Â  Â  Â  width:min(520px, 92vw);
Â  Â  Â  margin: 0 auto 14px;
Â  Â  Â  background: rgba(255,255,255,.14);
Â  Â  Â  border: 1px solid rgba(255,255,255,.18);
Â  Â  Â  border-radius:18px;
Â  Â  Â  padding:12px;
Â  Â  Â  text-align:left;
Â  Â  Â  backdrop-filter: blur(8px);
Â  Â  }
Â  Â  .loginPanel input{
Â  Â  Â  width:100%;
Â  Â  Â  padding:10px;
Â  Â  Â  border-radius:10px;
Â  Â  Â  border:1px solid rgba(255,255,255,.22);
Â  Â  Â  margin-bottom:8px;
Â  Â  Â  font-size:14px;
Â  Â  Â  box-sizing:border-box;
Â  Â  Â  background: rgba(255,255,255,.9);
Â  Â  }
Â  Â  .loginPanel button{
Â  Â  Â  width:100%;
Â  Â  Â  padding:10px;
Â  Â  Â  border-radius:999px;
Â  Â  Â  border:0;
Â  Â  Â  background:#111;
Â  Â  Â  color:#fff;
Â  Â  Â  font-weight:700;
Â  Â  Â  cursor:pointer;
Â  Â  }
Â  Â  .loginHint{
Â  Â  Â  font-size:12px;
Â  Â  Â  opacity:.85;
Â  Â  Â  margin-top:8px;
Â  Â  }

Â  Â  .hint{
Â  Â  Â  margin-top: 12px;
Â  Â  Â  font-size: 13px;
Â  Â  Â  opacity: .85;
Â  Â  }
Â  </style>
</head>

<body>
Â  <canvas id="snow"></canvas>

Â  <div class="wrap">
Â  Â  <h1>ğŸ„ ì—°ì§€ì˜ í¸ì§€í•¨ ğŸ„</h1>
Â  Â  Â  Â  <div class="sub">ë¡œê·¸ì¸ í›„ ë©”ì¼ë°•ìŠ¤(ğŸ“®)ë¥¼ ëˆŒëŸ¬ ì „ì²´ í¸ì§€ë¥¼ ë³¼ ìˆ˜ ìˆì–´</div>

Â  Â  Â  Â  <div class="loginPanel" id="loginPanel">
Â  Â  Â  <input id="email" placeholder="ì—°ì§€ ì´ë©”ì¼">
Â  Â  Â  <input id="password" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸">
Â  Â  Â  <button id="loginBtn">ë¡œê·¸ì¸í•˜ê³  í¸ì§€ ë³´ê¸°</button>
Â  Â  Â  <div class="loginHint">ë¡œê·¸ì¸ í›„ ì „ì²´ í¸ì§€ê°€ ë³´ì—¬.</div>
Â  Â  </div>

Â  Â  <button id="musicBtn" class="musicBtn">ìŒì•… ì¼œê¸°</button>
Â  Â  <audio id="bgm" src="christmas.mp3" loop preload="auto"></audio>

Â  Â  <div class="stage">
Â  Â  Â  <img src="tree.png" class="tree" alt="tree">
Â  Â  Â  <div class="treeGlow"></div>

Â  Â  Â  <div id="mailbox" class="mailbox" title="ì „ì²´ í¸ì§€ ëª¨ì•„ë³´ê¸°">
Â  Â  Â  Â  <img src="mailbox.png" alt="mailbox">
Â  Â  Â  </div>

Â  Â  Â  <div class="light" style="left:38%; top:22%; animation-delay:0s;"></div>
Â  Â  Â  <div class="light" style="left:58%; top:28%; animation-delay:.35s;"></div>
Â  Â  Â  <div class="light" style="left:46%; top:36%; animation-delay:.7s;"></div>
Â  Â  Â  <div class="light" style="left:33%; top:48%; animation-delay:1.05s;"></div>
Â  Â  Â  <div class="light" style="left:62%; top:54%; animation-delay:.55s;"></div>
Â  Â  Â  <div class="light" style="left:42%; top:62%; animation-delay:.9s;"></div>

Â  Â  Â  Â  Â  Â  <div class="ornament" style="left:46%; top:22%;" data-photo="photo1">
Â  Â  Â  Â  <div class="string"></div><div class="hook"></div>
Â  Â  Â  Â  <img src="photo1.png" alt="p1a"><div class="note">âœ‰ï¸</div>
Â  Â  Â  </div>

Â  Â  Â  <div class="ornament" style="left:50%; top:44%;" data-photo="photo1">
Â  Â  Â  Â  <div class="string"></div><div class="hook"></div>
Â  Â  Â  Â  <img src="photo2.png" alt="p1b"><div class="note">âœ‰ï¸</div>
Â  Â  Â  </div>

Â  Â  Â  <div class="ornament" style="left:30%; top:44%;" data-photo="photo2">
Â  Â  Â  Â  <div class="string"></div><div class="hook"></div>
Â  Â  Â  Â  <img src="photo3.png" alt="p2a"><div class="note">âœ‰ï¸</div>
Â  Â  Â  </div>

Â  Â  Â  <div class="ornament" style="left:20%; top:64%;" data-photo="photo2">
Â  Â  Â  Â  <div class="string"></div><div class="hook"></div>
Â  Â  Â  Â  <img src="photo3.png" alt="p2b"><div class="note">âœ‰ï¸</div>
Â  Â  Â  </div>

Â  Â  Â  <div class="ornament" style="left:40%; top:64%;" data-photo="photo3">
Â  Â  Â  Â  <div class="string"></div><div class="hook"></div>
Â  Â  Â  Â  <img src="photo1.png" alt="p3a"><div class="note">âœ‰ï¸</div>
Â  Â  Â  </div>

Â  Â  Â  <div class="ornament" style="left:60%; top:64%;" data-photo="photo3">
Â  Â  Â  Â  <div class="string"></div><div class="hook"></div>
Â  Â  Â  Â  <img src="photo2.png" alt="p3b"><div class="note">âœ‰ï¸</div>
Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div class="hint">ì—°ì§€ì•¼ ìƒì¼ ì¶•í•˜í•´</div>
Â  </div>

Â  <div class="modalBack" id="modal">
Â  Â  <div class="modal">
Â  Â  Â  <div class="top">
Â  Â  Â  Â  <strong id="title"></strong>
Â  Â  Â  Â  <button class="close" id="closeBtn">ë‹«ê¸°</button>
Â  Â  Â  </div>
Â  Â  Â  <div class="letters" id="letters"></div>
Â  Â  </div>
Â  </div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";
import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";

const firebaseConfig = {
Â  apiKey: "AIzaSyCZ5tseaOlmlcnZbduKyqo9hsLCiVvIeI4",
Â  authDomain: "yj-birthday.firebaseapp.com",
Â  projectId: "yj-birthday",
Â  storageBucket: "yj-birthday.firebasestorage.app",
Â  messagingSenderId: "664910382832",
Â  appId: "1:664910382832:web:e6e2a1cf78d02e2fd66435"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

function safeText(s){
Â  return (s || "").replaceAll("<","&lt;").replaceAll(">","&gt;");
}

const modal = document.getElementById("modal");
const closeBtn = document.getElementById("closeBtn");
const titleEl = document.getElementById("title");
const lettersEl = document.getElementById("letters");
const mailbox = document.getElementById("mailbox"); 

function openModal(title){
Â  titleEl.textContent = title;
Â  modal.style.display = "flex";
}
function closeModal(){
Â  modal.style.display = "none";
}
closeBtn.addEventListener("click", closeModal);
modal.addEventListener("click", (e)=>{ if(e.target === modal) closeModal(); });

function showNeedLogin(){
Â  openModal("ë¡œê·¸ì¸ì´ í•„ìš”í•´");
Â  lettersEl.innerHTML = `<div class="item"><div class="msg">ì—°ì§€ ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•´ì•¼ ì „ì²´ í¸ì§€ë¥¼ ë³¼ ìˆ˜ ìˆì–´.</div></div>`;
}

let loggedIn = false;

// ===== ë¡œê·¸ì¸ =====
document.getElementById("loginBtn").addEventListener("click", async ()=>{
Â  try{
Â  Â  const email = document.getElementById("email").value.trim();
Â  Â  const pw = document.getElementById("password").value.trim();
Â  Â  
Â  Â  if(!email || !pw){
Â  Â  Â  alert("ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
Â  Â  Â  return;
Â  Â  }
Â  Â  
Â  Â  await signInWithEmailAndPassword(auth, email, pw);

Â  Â  loggedIn = true;
Â  Â  document.getElementById("loginPanel").style.display = "none";
Â  Â  
Â  Â  alert("ë¡œê·¸ì¸ ì™„ë£Œ! ë©”ì¼ë°•ìŠ¤ë¥¼ ëˆŒëŸ¬ ì „ì²´ í¸ì§€ë¥¼ í™•ì¸í•´ë´.");
Â  Â  
Â  }catch(e){
Â  Â  alert("ë¡œê·¸ì¸ ì‹¤íŒ¨: " + e.message);
Â  }
});

// ===== í¸ì§€ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° (ì „ì²´ í¸ì§€) =====
async function loadAllLetters(){
Â  const snap = await getDocs(collection(db,"letters"));
Â  const list = [];
Â  snap.forEach(d=>{
Â  Â  const v = d.data();
Â  Â  list.push({
Â  Â  Â  writer: v.writer || "ìµëª…",
Â  Â  Â  message: v.message || "",
Â  Â  Â  photoKey: v.photoKey || "",
Â  Â  Â  createdAtMs: v.createdAt?.toMillis ? v.createdAt.toMillis() : 0
Â  Â  });
Â  });
Â  list.sort((a,b)=> b.createdAtMs - a.createdAtMs);
Â  return list;
}

function renderList(list){
Â  if(list.length === 0){
Â  Â  lettersEl.innerHTML = `<div class="item"><div class="msg">ì•„ì§ ë„ì°©í•œ í¸ì§€ê°€ ì—†ì–´.</div></div>`;
Â  Â  return;
Â  }
Â  
Â  lettersEl.innerHTML = list.map(v=>`
Â  Â  <div class="item">
Â  Â  Â  <div class="meta">${safeText(v.writer)} (ì˜¤ë„ˆë¨¼íŠ¸: ${safeText(v.photoKey)})</div>
Â  Â  Â  <div class="msg">${safeText(v.message)}</div>
Â  Â  Â  <div class="meta">${v.createdAtMs ? new Date(v.createdAtMs).toLocaleString('ko-KR') : ''}</div>
Â  Â  </div>
Â  `).join("");
}

// âŒ ì˜¤ë„ˆë¨¼íŠ¸ í´ë¦­ ì´ë²¤íŠ¸ ì œê±°: ì˜¤ë¡œì§€ ë©”ì¼ë°•ìŠ¤ë¥¼ í†µí•´ì„œë§Œ í¸ì§€ í™•ì¸
document.querySelectorAll(".ornament").forEach(o=>{
Â  o.addEventListener("click", (e)=>{
Â  Â  // ì˜¤ë„ˆë¨¼íŠ¸ í´ë¦­ ì‹œ ì•„ë¬´ ì¼ë„ ì¼ì–´ë‚˜ì§€ ì•Šë„ë¡ ë§‰ìŠµë‹ˆë‹¤.
Â  Â  e.preventDefault();
Â  Â  if(!loggedIn){
Â  Â  Â  showNeedLogin();
Â  Â  }
Â  });
});


// âœ… ë©”ì¼ë°•ìŠ¤ í´ë¦­ ì´ë²¤íŠ¸ (ì „ì²´ í¸ì§€ ë³´ê¸°)
mailbox.addEventListener("click", async ()=>{
Â  if(!loggedIn){ showNeedLogin(); return; }
Â  openModal("ğŸ“® ì „ì²´ í¸ì§€ ëª¨ì•„ë³´ê¸°");
Â  try{
Â  Â  const list = await loadAllLetters();
Â  Â  renderList(list);
Â  }catch(e){
Â  Â  lettersEl.innerHTML = `<div class="item"><div class="msg">ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: ${safeText(e.message)}</div></div>`;
Â  }
});


// ===== ìŒì•… í† ê¸€ =====
const bgm = document.getElementById("bgm");
const musicBtn = document.getElementById("musicBtn");
let playing = false;

musicBtn.addEventListener("click", async () => {
Â  try{
Â  Â  if(!playing){
Â  Â  Â  await bgm.play();
Â  Â  Â  playing = true;
Â  Â  Â  musicBtn.textContent = "ìŒì•… ë„ê¸°";
Â  Â  }else{
Â  Â  Â  bgm.pause();
Â  Â  Â  playing = false;
Â  Â  Â  musicBtn.textContent = "ìŒì•… ì¼œê¸°";
Â  Â  }
Â  }catch(e){
Â  Â  alert("ì¬ìƒì´ ë§‰í˜”ì–´. ë²„íŠ¼ì„ ë‹¤ì‹œ ëˆŒëŸ¬ì¤˜.");
Â  }
});

// ===== ëˆˆ ë‚´ë¦¬ëŠ” íš¨ê³¼(Canvas) =====
const canvas = document.getElementById("snow");
const ctx = canvas.getContext("2d");
let W = 0, H = 0;

function resizeSnow(){
Â  W = canvas.width = window.innerWidth;
Â  H = canvas.height = window.innerHeight;
}
window.addEventListener("resize", resizeSnow);
resizeSnow();

const flakes = [];
function rebuildFlakes(){
Â  flakes.length = 0;
Â  const count = Math.min(160, Math.floor((W * H) / 12000));
Â  for(let i=0;i<count;i++){
Â  Â  flakes.push({
Â  Â  Â  x: Math.random() * W,
Â  Â  Â  y: Math.random() * H,
Â  Â  Â  r: Math.random() * 2.2 + 0.7,
Â  Â  Â  vx: Math.random() * 0.6 - 0.3,
Â  Â  Â  vy: Math.random() * 1.3 + 0.5,
Â  Â  Â  a: Math.random() * 0.55 + 0.25,
Â  Â  Â  wob: Math.random() * 3.14
Â  Â  });
Â  }
}
rebuildFlakes();
window.addEventListener("resize", rebuildFlakes);

function snowTick(){
Â  ctx.clearRect(0,0,W,H);
Â  for(const f of flakes){
Â  Â  f.wob += 0.02;
Â  Â  f.x += f.vx + Math.sin(f.wob) * 0.25;
Â  Â  f.y += f.vy;

Â  Â  if(f.y > H + 10){ f.y = -10; f.x = Math.random() * W; }
Â  Â  if(f.x > W + 10) f.x = -10;
Â  Â  if(f.x < -10) f.x = W + 10;

Â  Â  ctx.globalAlpha = f.a;
Â  Â  ctx.beginPath();
Â  Â  ctx.arc(f.x, f.y, f.r, 0, Math.PI * 2);
Â  Â  ctx.fillStyle = "#ffffff";
Â  Â  ctx.fill();
Â  }
Â  ctx.globalAlpha = 1;
Â  requestAnimationFrame(snowTick);
}
snowTick();
</script>
</body>
</html>
