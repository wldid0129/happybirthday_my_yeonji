<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ì—°ì§€ì˜ í¬ë¦¬ìŠ¤ë§ˆìŠ¤ íŠ¸ë¦¬</title>

  <style>
    body{
      margin:0;
      background: radial-gradient(circle at 20% 10%, rgba(255,255,255,.16), transparent 42%),
                  linear-gradient(135deg, #b81d24 0%, #0b6b3a 100%);
      color:#fff;
      font-family: 'Apple SD Gothic Neo','Noto Sans KR',system-ui,sans-serif;
      overflow-x:hidden;
    }

    #snow{
      position:fixed;
      inset:0;
      pointer-events:none;
      z-index: 2;
    }

    .wrap{
      max-width: 980px;
      margin: 0 auto;
      padding: 28px 16px 80px;
      text-align:center;
      position: relative;
      z-index: 3;
    }

    h1{ margin:10px 0 6px; }
    .sub{ font-size:14px; opacity:.85; margin-bottom:12px; }

    .musicBtn{
      margin: 10px auto 16px;
      padding:10px 14px;
      border:0;
      border-radius:999px;
      background: rgba(255,255,255,.18);
      color:#fff;
      font-weight:700;
      cursor:pointer;
      backdrop-filter: blur(6px);
    }

    .stage{
      position:relative;
      width:min(520px, 92vw);
      aspect-ratio:1/1;
      margin:0 auto;
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.18);
      border-radius:22px;
      box-shadow:0 18px 50px rgba(0,0,0,.25);
      overflow:hidden;
    }

    .tree{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      object-fit: contain;
      z-index: 1;
      filter: drop-shadow(0 16px 30px rgba(0,0,0,.22));
    }

    .light{
      position:absolute;
      width:10px;
      height:10px;
      border-radius:50%;
      background: rgba(255,255,255,.95);
      box-shadow: 0 0 14px rgba(255,255,255,.95);
      animation: twinkle 1.4s infinite ease-in-out;
      opacity: .75;
      z-index: 2;
    }
    @keyframes twinkle{
      0%{ transform: scale(.7); opacity:.35; }
      50%{ transform: scale(1.3); opacity:1; }
      100%{ transform: scale(.7); opacity:.35; }
    }

    .treeGlow{
      position:absolute;
      inset:0;
      z-index: 2;
      pointer-events:none;
      background: radial-gradient(circle at 50% 40%, rgba(255,255,255,.20), transparent 55%);
      animation: glowPulse 2.4s ease-in-out infinite;
      mix-blend-mode: screen;
    }
    @keyframes glowPulse{
      0%{ opacity:.25; transform: scale(1); }
      50%{ opacity:.65; transform: scale(1.02); }
      100%{ opacity:.25; transform: scale(1); }
    }

    .ornament{
  position:absolute;
  width:78px;           /* PNG ì‹¤ì œ í¬ê¸°ì— ë§ê²Œ */
  height:auto;          /* ë¹„ìœ¨ ìœ ì§€ */
  cursor:pointer;
  z-index: 3;
  transform: translate(-50%, -50%);
  filter: drop-shadow(0 10px 18px rgba(0,0,0,.35));
  transition: transform .15s ease;
}
.ornament:hover{
  transform: translate(-50%, -50%) scale(1.06);
}

/* ì´ë¯¸ì§€ê°€ ì¥ì‹ ê·¸ ìì²´ */
.ornament img{
  width:100%;
  height:auto;
  display:block;
}


    .hook{
      position:absolute;
      width:18px;
      height:18px;
      border-radius:50%;
      border: 2px solid rgba(255,255,255,.95);
      background: rgba(0,0,0,.10);
      top:-14px;
      left:50%;
      transform: translateX(-50%);
      box-shadow: 0 6px 14px rgba(0,0,0,.25);
    }
    .string{
      position:absolute;
      width:2px;
      height:22px;
      background: rgba(255,255,255,.75);
      top:-22px;
      left:50%;
      transform: translateX(-50%);
      border-radius: 2px;
    }

    .note{
      position:absolute;
      right:2px;
      bottom:2px;
      transform: scale(.9);
      width:30px;
      height:30px;
      border-radius:50%;
      background:#fff;
      color:#111;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:16px;
      box-shadow:0 6px 14px rgba(0,0,0,.25);
    }

    /* ë©”ì¼ë°•ìŠ¤(mailbox.png) */
    .mailbox{
      position:absolute;
      left:85%;
      top:86%;
      transform:translate(-50%,-50%);
      width:72px;
      height:72px;
      border-radius:18px;
      background: rgba(255,255,255,.12);
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      z-index: 6;
      box-shadow: 0 14px 28px rgba(0,0,0,.25);
      backdrop-filter: blur(6px);
      border: 1px solid rgba(255,255,255,.2);
    }
    .mailbox:hover{ transform:translate(-50%,-50%) scale(1.03); }
    .mailbox img{
      width:52px;
      height:52px;
      object-fit: contain;
      display:block;
      pointer-events:none;
      filter: drop-shadow(0 10px 18px rgba(0,0,0,.25));
    }

    .modalBack{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.55);
      display:none;
      align-items:center;
      justify-content:center;
      padding:16px;
      z-index: 20;
    }
    .modal{
      width:min(720px, 96vw);
      background: rgba(255,255,255,.96);
      color:#222;
      border-radius:18px;
      padding:16px;
      text-align:left;
      box-shadow: 0 18px 70px rgba(0,0,0,.35);
    }
    .top{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:10px;
    }
    .close{
      border:0;
      background:#eee;
      padding:6px 10px;
      border-radius:8px;
      cursor:pointer;
    }

    /* ì˜¤ë„ˆë¨¼íŠ¸ ëˆŒë €ì„ ë•Œ: ì•ˆë‚´ ë©”ì‹œì§€ ì˜ì—­ */
    .letters{
      max-height:180px;
      overflow:auto;
      background:#f7f7f7;
      border-radius:12px;
      padding:10px;
      margin-bottom:10px;
      color:#222;
    }
    .item{
      background:#fff;
      border-radius:12px;
      padding:10px;
      margin-bottom:8px;
      font-size:14px;
    }
    .meta{ font-size:12px; opacity:.6; margin-bottom:4px; }
    .msg{ white-space: pre-line; line-height: 1.7; }

    .itemTop{
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    .deleteBtn{
      border:0;
      background:transparent;
      cursor:pointer;
      font-size:16px;
      opacity:.55;
    }
    .deleteBtn:hover{ opacity:1; }

    .editBtn{
      margin-top:8px;
      border:0;
      padding:7px 10px;
      border-radius:10px;
      cursor:pointer;
      background:#eee;
    }

    /* í¸ì§€ ì•„ì´ì½˜(ìŠ¤íƒ) */
    .envelopes{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
    }
    .envBtn{
      width:52px;
      height:52px;
      border-radius:14px;
      border:0;
      cursor:pointer;
      background:#fff;
      box-shadow: 0 10px 22px rgba(0,0,0,.15);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:26px;
    }

    textarea,input{
      width:100%;
      padding:10px;
      border-radius:10px;
      border:1px solid #ccc;
      margin-bottom:8px;
      font-size:14px;
      box-sizing: border-box;
    }
    button.send{
      width:100%;
      padding:10px;
      border-radius:999px;
      border:0;
      background:#111;
      color:#fff;
      font-weight:700;
      cursor:pointer;
    }

    .hint{
      margin-top: 12px;
      font-size: 13px;
      opacity: .85;
    }
  </style>
</head>

<body>
  <canvas id="snow"></canvas>

  <div class="wrap">
    <h1>ğŸ„ ì—°ì§€ì˜ íŠ¸ë¦¬ í¸ì§€í•¨ ğŸ„</h1>
    <div class="sub">ì˜¤ë„ˆë¨¼íŠ¸ë¥¼ ëˆŒëŸ¬ì„œ í¸ì§€ë¥¼ ì¨ì¤˜</div>

    <button id="musicBtn" class="musicBtn">ìŒì•… ì¼œê¸°</button>
    <audio id="bgm" src="christmas.mp3" loop preload="auto"></audio>

    <div class="stage">
      <img src="tree.png" class="tree" alt="tree">
      <div class="treeGlow"></div>

      <!-- mailbox.png ì‚¬ìš© -->
      <div id="mailbox" class="mailbox" title="ë‚´ í¸ì§€í•¨">
        <img src="mailbox.png" alt="mailbox">
      </div>

      <div class="light" style="left:38%; top:22%; animation-delay:0s;"></div>
      <div class="light" style="left:58%; top:28%; animation-delay:.35s;"></div>
      <div class="light" style="left:46%; top:36%; animation-delay:.7s;"></div>
      <div class="light" style="left:33%; top:48%; animation-delay:1.05s;"></div>
      <div class="light" style="left:62%; top:54%; animation-delay:.55s;"></div>
      <div class="light" style="left:42%; top:62%; animation-delay:.9s;"></div>

<div class="ornament" style="left:50%; top:22%;" data-photo="photo1">
  <img src="photo1.png" alt="p1a"><div class="note">âœ‰ï¸</div>
</div>

<div class="ornament" style="left:60%; top:47%;" data-photo="photo1">
  <img src="photo2.png" alt="p1b"><div class="note">âœ‰ï¸</div>
</div>

<div class="ornament" style="left:40%; top:47%;" data-photo="photo2">
  <img src="photo3.png" alt="p2a"><div class="note">âœ‰ï¸</div>
</div>

<div class="ornament" style="left:30%; top:70%;" data-photo="photo2">
  <img src="photo3.png" alt="p2b"><div class="note">âœ‰ï¸</div>
</div>

<div class="ornament" style="left:50%; top:70%;" data-photo="photo3">
  <img src="photo1.png" alt="p3a"><div class="note">âœ‰ï¸</div>
</div>

<div class="ornament" style="left:70%; top:70%;" data-photo="photo3">
  <img src="photo2.png" alt="p3b"><div class="note">âœ‰ï¸</div>
</div>

    </div>

    <div class="hint">ì—°ì§€ì•¼ ìƒì¼ ì¶•í•˜í•´</div>
  </div>

  <!-- ëª¨ë‹¬ êµ¬ì¡°(ì •ìƒì ìœ¼ë¡œ ë‹«í˜) -->
  <div class="modalBack" id="modal">
    <div class="modal">
      <div class="top">
        <strong id="title"></strong>
        <button class="close" id="closeBtn">ë‹«ê¸°</button>
      </div>

      <div class="letters" id="letters"></div>

      <div id="envelopeArea" style="display:none;">
        <div class="envelopes" id="envelopes"></div>
      </div>

      <div id="formArea">
        <input id="writer" placeholder="ì´ë¦„">
        <textarea id="message" placeholder="ì—°ì§€ì—ê²Œ ë‚¨ê¸¸ í¸ì§€"></textarea>
        <button class="send" id="send">í¸ì§€ ì €ì¥</button>
      </div>
    </div>
  </div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";
import {
Â  getFirestore, collection, addDoc, query, where, getDocs,
Â  serverTimestamp, doc, updateDoc, deleteDoc
} from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";

const firebaseConfig = {
Â  apiKey: "AIzaSyCZ5tseaOlmlcnZbduKyqo9hsLCiVvIeI4",
Â  authDomain: "yj-birthday.firebaseapp.com",
Â  projectId: "yj-birthday",
Â  storageBucket: "yj-birthday.firebasestorage.app",
Â  messagingSenderId: "664910382832",
Â  appId: "1:664910382832:web:e6e2a1cf78d02e2fd66435"
};

const WRITE_KEY = "YJ_TREE_2025_9aK3QzT2";
const urlKey = new URLSearchParams(location.search).get("k") || "";
const canWrite = (urlKey === WRITE_KEY);

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
await signInAnonymously(auth);

function safeText(s){
Â  return (s || "").replaceAll("<","&lt;").replaceAll(">","&gt;");
}

// ===== ìŒì•… í† ê¸€ =====
const bgm = document.getElementById("bgm");
const musicBtn = document.getElementById("musicBtn");
let playing = false;

musicBtn.addEventListener("click", async () => {
Â  try{
Â  Â  if(!playing){
Â  Â  Â  await bgm.play();
Â  Â  Â  playing = true;
Â  Â  Â  musicBtn.textContent = "ìŒì•… ë„ê¸°";
Â  Â  }else{
Â  Â  Â  bgm.pause();
Â  Â  Â  playing = false;
Â  Â  Â  musicBtn.textContent = "ìŒì•… ì¼œê¸°";
Â  Â  }
Â  }catch(e){
Â  Â  alert("ì¬ìƒì´ ë§‰í˜”ì–´. ë²„íŠ¼ì„ ë‹¤ì‹œ ëˆŒëŸ¬ì¤˜.");
Â  }
});

// ===== DOM =====
const modal = document.getElementById("modal");
const closeBtn = document.getElementById("closeBtn");
const titleEl = document.getElementById("title");
const lettersEl = document.getElementById("letters");

const envelopeArea = document.getElementById("envelopeArea");
const envelopesEl = document.getElementById("envelopes");

const formArea = document.getElementById("formArea");
const writerEl = document.getElementById("writer");
const messageEl = document.getElementById("message");
const sendBtn = document.getElementById("send");

const mailbox = document.getElementById("mailbox");

let currentPhoto = "";
let editingId = null;
let mailboxCache = []; // ë‚´ í¸ì§€ ëª©ë¡ ìºì‹œ

function openModalBase(title){
Â  titleEl.textContent = title;
Â  modal.style.display = "flex";
}
function closeModal(){
Â  modal.style.display = "none";
}
closeBtn.addEventListener("click", closeModal);
modal.addEventListener("click", (e)=>{
Â  if(e.target === modal) closeModal();
});

// ë³´ê¸° ì „ìš©ì´ë©´ ì‘ì„±/ìˆ˜ì •/ì‚­ì œ ìì²´ë¥¼ ë§‰ê¸°
if(formArea && !canWrite){
Â  formArea.style.display = "none";
}

// ===== 1) ì˜¤ë„ˆë¨¼íŠ¸ í´ë¦­: ì‘ì„±ë§Œ =====
document.querySelectorAll(".ornament").forEach(o=>{
Â  o.addEventListener("click", ()=>{
Â  Â  currentPhoto = o.dataset.photo;
Â  Â  editingId = null;

Â  Â  openModalBase("í¸ì§€ ì“°ê¸°");

Â  Â  // ë‚¨ì˜ í¸ì§€ ëª©ë¡ì„ ë³´ì—¬ì£¼ì§€ ì•ŠìŒ
Â  Â  lettersEl.style.display = "block";
Â  Â  lettersEl.innerHTML = canWrite
Â  Â  Â  ? `<div class="item"><div class="msg">ì—¬ê¸°ì— í¸ì§€ë¥¼ ì“°ê³  ì €ì¥í•˜ë©´ ë‚´ í¸ì§€í•¨(ğŸ“®)ì— ìŒ“ì—¬.</div></div>`
Â  Â  Â  : `<div class="item"><div class="msg">ë³´ê¸° ì „ìš© ë§í¬ì•¼. í¸ì§€ëŠ” ì‘ì„±í•  ìˆ˜ ì—†ì–´.</div></div>`;

Â  Â  envelopeArea.style.display = "none";

Â  Â  if(canWrite){
Â  Â  Â  formArea.style.display = "block";
Â  Â  Â  sendBtn.textContent = "í¸ì§€ ì €ì¥";
Â  Â  Â  writerEl.value = writerEl.value || "";
Â  Â  Â  messageEl.value = "";
Â  Â  Â  messageEl.focus();
Â  Â  }else{
Â  Â  Â  formArea.style.display = "none";
Â  Â  }
Â  });
});

// ===== 2) ë©”ì¼ë°•ìŠ¤ í´ë¦­: ë‚´ í¸ì§€ ëª©ë¡(âœ‰ï¸ ìŠ¤íƒ) =====
async function loadMyLetters(){
Â  const q = query(collection(db,"letters"), where("authorUid","==", auth.currentUser.uid));
Â  const snap = await getDocs(q);

Â  const list = [];
Â  snap.forEach(d=>{
Â  Â  const v = d.data();
Â  Â  list.push({
Â  Â  Â  id: d.id,
Â  Â  Â  writer: v.writer || "ìµëª…",
Â  Â  Â  message: v.message || "",
Â  Â  Â  photoKey: v.photoKey || "",
Â  Â  Â  createdAtMs: v.createdAt?.toMillis ? v.createdAt.toMillis() : 0
Â  Â  });
Â  });

Â  list.sort((a,b)=> b.createdAtMs - a.createdAtMs);
Â  return list;
}

function renderEnvelopeStack(list){
Â  if(list.length === 0){
Â  Â  envelopesEl.innerHTML = `<div class="item"><div class="msg">ì•„ì§ ë‚´ê°€ ì“´ í¸ì§€ê°€ ì—†ì–´.</div></div>`;
Â  Â  return;
Â  }

Â  envelopesEl.innerHTML = list.map(x=>`
Â  Â  <button class="envBtn" data-id="${x.id}" title="${safeText(x.photoKey)} í¸ì§€">âœ‰ï¸</button>
Â  `).join("");
}

mailbox.addEventListener("click", async ()=>{
Â  openModalBase("ë‚´ í¸ì§€í•¨");

Â  // í¸ì§€í•¨ ëª¨ë“œ
Â  lettersEl.style.display = "none";
Â  envelopeArea.style.display = "block";
Â  if(formArea) formArea.style.display = "none";

Â  try{
Â  Â  mailboxCache = await loadMyLetters();
Â  Â  renderEnvelopeStack(mailboxCache);
Â  }catch(e){
Â  Â  envelopesEl.innerHTML = `<div class="item"><div class="msg">ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: ${safeText(e.message)}</div></div>`;
Â  }
});

// âœ‰ï¸ í´ë¦­: í•´ë‹¹ í¸ì§€ ì—´ê¸°(ë‚´ ê¸€ì´ë¯€ë¡œ ìˆ˜ì •/ì‚­ì œ ê°€ëŠ¥, ë³´ê¸°ì „ìš©ì´ë©´ ì½ê¸°ë§Œ)
envelopesEl.addEventListener("click", (e)=>{
Â  const b = e.target.closest(".envBtn");
Â  if(!b) return;

Â  const found = mailboxCache.find(v=>v.id === b.dataset.id);
Â  if(!found) return;

Â  envelopeArea.style.display = "none";
Â  lettersEl.style.display = "block";

Â  // ìˆ˜ì •: metaì— photoKey ëŒ€ì‹  writer í‘œì‹œ
Â  let letterHtml = `<div class="item">`;
Â  if(canWrite){
Â  Â  letterHtml += `<div class="itemTop">
Â  Â  Â  <div class="meta">${safeText(found.writer)}</div>
Â  Â  Â  <button class="deleteBtn" data-id="${found.id}">ğŸ—‘ï¸ ì‚­ì œ</button>
Â  Â  </div>`;
Â  }else{
Â  Â  letterHtml += `<div class="meta">${safeText(found.writer)} (${safeText(found.photoKey)})</div>`;
Â  }
Â  letterHtml += `<div class="msg">${safeText(found.message)}</div></div>`;
Â  lettersEl.innerHTML = letterHtml;

Â  if(!canWrite){
Â  Â  // ë³´ê¸° ì „ìš©ì€ ì½ê¸°ë§Œ
Â  Â  if(formArea) formArea.style.display = "none";
Â  Â  return;
Â  }

Â  // ì“°ê¸° ë§í¬ë©´ ìˆ˜ì •ëª¨ë“œë¡œ ì—´ê¸°
Â  if(formArea) formArea.style.display = "block";
Â  currentPhoto = found.photoKey;
Â  editingId = found.id;
Â  writerEl.value = found.writer;
Â  messageEl.value = found.message;
Â  sendBtn.textContent = "ìˆ˜ì • ì €ì¥";
});

// ===== ì €ì¥ / ìˆ˜ì • ì €ì¥ =====
sendBtn.addEventListener("click", async ()=>{
Â  if(!canWrite){
Â  Â  alert("ë³´ê¸° ì „ìš© ë§í¬ì•¼. ì“°ê¸° ë§í¬(?k=...)ë¡œ ì ‘ì†í•´ì•¼ í•´.");
Â  Â  return;
Â  }

Â  const writer = writerEl.value.trim() || "ìµëª…";
Â  const message = messageEl.value.trim();
Â  if(message.length < 2){
Â  Â  alert("í¸ì§€ë¥¼ 2ê¸€ì ì´ìƒ ì ì–´ì¤˜");
Â  Â  return;
Â  }

Â  sendBtn.disabled = true;

Â  try{
Â  Â  if(editingId){
Â  Â  Â  await updateDoc(doc(db,"letters", editingId), {
Â  Â  Â  Â  writer,
Â  Â  Â  Â  message,
Â  Â  Â  Â  writeKey: urlKey
Â  Â  Â  });
Â  Â  Â  // ìˆ˜ì • ì™„ë£Œ í›„ í¸ì§‘ ëª¨ë“œ ì´ˆê¸°í™” (ìˆ˜ì • ì €ì¥ ì œí•œ)
Â  Â  Â  editingId = null;
Â  Â  Â  sendBtn.textContent = "í¸ì§€ ì €ì¥"; // ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³µêµ¬
Â  Â  Â  alert("ìˆ˜ì • ì™„ë£Œ. ì´ì œ ìƒˆë¡œìš´ í¸ì§€ë§Œ ì‘ì„±í•  ìˆ˜ ìˆì–´.");
Â  Â  }else{
Â  Â  Â  await addDoc(collection(db,"letters"),{
Â  Â  Â  Â  photoKey: currentPhoto,
Â  Â  Â  Â  writer,
Â  Â  Â  Â  message,
Â  Â  Â  Â  authorUid: auth.currentUser.uid,
Â  Â  Â  Â  writeKey: urlKey,
Â  Â  Â  Â  createdAt: serverTimestamp()
Â  Â  Â  });
Â  Â  Â  alert("ì €ì¥ ì™„ë£Œ. ì—°ì§€ í¸ì§€í•¨(ğŸ“®)ì— ìŒ“ì˜€ì–´.");
Â  Â  }

Â  Â  messageEl.value = "";

Â  }catch(e){
Â  Â  alert("ì €ì¥ ì‹¤íŒ¨: " + e.message);
Â  }finally{
Â  Â  sendBtn.disabled = false;
Â  }
});

// ===== ì‚­ì œ ë¡œì§ (lettersEl ë‚´ë¶€ì—ì„œ ë°œìƒ) =====
lettersEl.addEventListener("click", async (e)=>{
Â  const deleteBtn = e.target.closest(".deleteBtn");
Â  if(!deleteBtn || !canWrite) return;

Â  const letterId = deleteBtn.dataset.id;
Â  const confirmMsg = "ì •ë§ë¡œ ì´ í¸ì§€ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?";

Â  if(!confirm(confirmMsg)){
Â  Â  return;
Â  }

Â  try{
Â  Â  // ì‚­ì œ ì‹¤í–‰
Â  Â  await deleteDoc(doc(db, "letters", letterId));
Â  Â  alert("í¸ì§€ê°€ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");

Â  Â  // ëª¨ë‹¬ ë‹«ê³ , ë©”ì¼í•¨ ëª©ë¡ ìƒˆë¡œê³ ì¹¨ì„ ìœ„í•´ ë©”ì¼ë°•ìŠ¤ í´ë¦­ ì´ë²¤íŠ¸ ì¬ì‹¤í–‰
Â  Â  closeModal();
Â  Â  mailbox.click(); 

Â  }catch(error){
Â  Â  alert("ì‚­ì œ ì‹¤íŒ¨: " + error.message);
Â  }
});

// ===== ëˆˆ ë‚´ë¦¬ëŠ” íš¨ê³¼(Canvas) =====
const canvas = document.getElementById("snow");
const ctx = canvas.getContext("2d");

let W = 0, H = 0;

function resizeSnow(){
Â  W = canvas.width = window.innerWidth;
Â  H = canvas.height = window.innerHeight;
}
window.addEventListener("resize", resizeSnow);
resizeSnow();

const flakes = [];
function rebuildFlakes(){
Â  flakes.length = 0;
Â  const count = Math.min(160, Math.floor((W * H) / 12000));
Â  for(let i=0;i<count;i++){
Â  Â  flakes.push({
Â  Â  Â  x: Math.random() * W,
Â  Â  Â  y: Math.random() * H,
Â  Â  Â  r: Math.random() * 2.2 + 0.7,
Â  Â  Â  vx: Math.random() * 0.6 - 0.3,
Â  Â  Â  vy: Math.random() * 1.3 + 0.5,
Â  Â  Â  a: Math.random() * 0.55 + 0.25,
Â  Â  Â  wob: Math.random() * 3.14
Â  Â  });
Â  }
}
rebuildFlakes();
window.addEventListener("resize", rebuildFlakes);

function snowTick(){
Â  ctx.clearRect(0,0,W,H);

Â  for(const f of flakes){
Â  Â  f.wob += 0.02;
Â  Â  f.x += f.vx + Math.sin(f.wob) * 0.25;
Â  Â  f.y += f.vy;

Â  Â  if(f.y > H + 10){ f.y = -10; f.x = Math.random() * W; }
Â  Â  if(f.x > W + 10) f.x = -10;
Â  Â  if(f.x < -10) f.x = W + 10;

Â  Â  ctx.globalAlpha = f.a;
Â  Â  ctx.beginPath();
Â  Â  ctx.arc(f.x, f.y, f.r, 0, Math.PI * 2);
Â  Â  ctx.fillStyle = "#ffffff";
Â  Â  ctx.fill();
Â  }

Â  ctx.globalAlpha = 1;
Â  requestAnimationFrame(snowTick);
}
snowTick();
</script>
